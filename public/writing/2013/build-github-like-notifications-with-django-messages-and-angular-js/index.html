






<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="true"
><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#FFFFFF" />
  
  <title>Build GitHub like notifications with Django messages and AngularJS &middot; /dev/ by Massimiliano Pippi</title>
    <meta name="title" content="Build GitHub like notifications with Django messages and AngularJS &middot; /dev/ by Massimiliano Pippi" />
  
  
  
  
  
  <script
    type="text/javascript"
    src="http://localhost:1313/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js"
    integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="
  ></script>
  
  
  
  
  
  
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="http://localhost:1313/css/main.bundle.min.2abed97d6210907523664b7e6725ba691bc95b0ee54b6e46cff169dfba68ae29.css"
    integrity="sha256-Kr7ZfWIQkHUjZkt&#43;ZyW6aRvJWw7lS25Gz/Fp37porik="
  />
  
  
  
  
  
  
  
  <meta
    name="description"
    content="
      
        Foreword #GitHub has a very nice notification system, very similar to a plain old email inbox. You receive a notification which
remains unread until you actually read it; then it&rsquo;s archived and removed from your inbox, which it happens could remain empty:







    
    








  
    
      
      
      
      
        
      
      
    
  




      
    "
  />
  
  
  
  
    <link rel="canonical" href="http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/" />
  
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/">
  <meta property="og:site_name" content="/dev/ by Massimiliano Pippi">
  <meta property="og:title" content="Build GitHub like notifications with Django messages and AngularJS">
  <meta property="og:description" content="Foreword #GitHub has a very nice notification system, very similar to a plain old email inbox. You receive a notification which remains unread until you actually read it; then it’s archived and removed from your inbox, which it happens could remain empty:">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writing">
    <meta property="article:published_time" content="2013-10-22T00:00:00+00:00">
    <meta property="article:modified_time" content="2013-10-22T00:00:00+00:00">
    <meta property="article:tag" content="Django">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Angularjs">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Build GitHub like notifications with Django messages and AngularJS">
  <meta name="twitter:description" content="Foreword #GitHub has a very nice notification system, very similar to a plain old email inbox. You receive a notification which remains unread until you actually read it; then it’s archived and removed from your inbox, which it happens could remain empty:">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Writings",
    "name": "Build GitHub like notifications with Django messages and AngularJS",
    "headline": "Build GitHub like notifications with Django messages and AngularJS",
    
    "abstract": "\u003ch2 id=\u0022foreword\u0022 class=\u0022relative group\u0022\u003eForeword \u003cspan class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100\u0022\u003e\u003ca class=\u0022group-hover:text-primary-300 dark:group-hover:text-neutral-700\u0022 style=\u0022text-decoration-line: none !important;\u0022 href=\u0022#foreword\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\u003c\/span\u003e\u003c\/h2\u003e\u003cp\u003eGitHub has a very nice notification system, very similar to a plain old email inbox. You receive a notification which\nremains \u003cem\u003eunread\u003c\/em\u003e until you actually read it; then it\u0026rsquo;s archived and removed from your \u003cem\u003einbox\u003c\/em\u003e, which it happens could remain empty:\u003c\/p\u003e\n\u003cp\u003e\n\n\n\n\n\n\u003cfigure\u003e\n    \n    \n\n\n\n\n\n\n\n\n  \n    \u003cpicture\n      class=\u0022mx-auto my-0 rounded-md\u0022\n      \n    \u003e\n      \n      \n      \n      \n        \u003csource\n          \n            srcset=\u0022http:\/\/localhost:1313\/writing\/2013\/build-github-like-notifications-with-django-messages-and-angular-js\/github_notifications_hu_41c587e860b771e0.webp 330w,http:\/\/localhost:1313\/writing\/2013\/build-github-like-notifications-with-django-messages-and-angular-js\/github_notifications_hu_8ee305e177ee3ccc.webp 660w\n            \n              \n                ,http:\/\/localhost:1313\/writing\/2013\/build-github-like-notifications-with-django-messages-and-angular-js\/github_notifications_hu_8019ab29f3cae25b.webp 1023w\n              \n            \n            \n              \n                ,http:\/\/localhost:1313\/writing\/2013\/build-github-like-notifications-with-django-messages-and-angular-js\/github_notifications_hu_8019ab29f3cae25b.webp 1023w\n              \n            \u0022\n          \n          sizes=\u0022100vw\u0022\n          type=\u0022image\/webp\u0022\n        \/\u003e\n      \n      \u003cimg\n        width=\u00221023\u0022\n        height=\u0022546\u0022\n        class=\u0022mx-auto my-0 rounded-md\u0022\n        alt=\u0022github inbox\u0022\n        loading=\u0022lazy\u0022 decoding=\u0022async\u0022\n        \n          src=\u0022http:\/\/localhost:1313\/writing\/2013\/build-github-like-notifications-with-django-messages-and-angular-js\/github_notifications_hu_7b191d354fa85b37.png\u0022 srcset=\u0022http:\/\/localhost:1313\/writing\/2013\/build-github-like-notifications-with-django-messages-and-angular-js\/github_notifications_hu_2230e08972812bc0.png 330w,http:\/\/localhost:1313\/writing\/2013\/build-github-like-notifications-with-django-messages-and-angular-js\/github_notifications_hu_7b191d354fa85b37.png 660w\n          \n            ,http:\/\/localhost:1313\/writing\/2013\/build-github-like-notifications-with-django-messages-and-angular-js\/github_notifications.png 1023w\n          \n          \n            ,http:\/\/localhost:1313\/writing\/2013\/build-github-like-notifications-with-django-messages-and-angular-js\/github_notifications.png 1023w\n          \u0022\n          sizes=\u0022100vw\u0022\n        \n      \/\u003e\n    \u003c\/picture\u003e\n  \n\n\n\u003c\/figure\u003e\n\u003c\/p\u003e",
    "inLanguage": "en",
    "url" : "http:\/\/localhost:1313\/writing\/2013\/build-github-like-notifications-with-django-messages-and-angular-js\/",
    "author" : {
      "@type": "Person",
      "name": "Massimiliano Pippi"
    },
    "copyrightYear": "2013",
    "dateCreated": "2013-10-22T00:00:00\u002b00:00",
    "datePublished": "2013-10-22T00:00:00\u002b00:00",
    
    "dateModified": "2013-10-22T00:00:00\u002b00:00",
    
    "keywords": ["django","python","angularjs"],
    
    "mainEntityOfPage": "true",
    "wordCount": "1536"
  }
  </script>
    
    <script type="application/ld+json">
    {
   "@context": "https://schema.org",
   "@type": "BreadcrumbList",
   "itemListElement": [
     {
       "@type": "ListItem",
       "item": "http://localhost:1313/",
       "name": "Dev by Massimiliano Pippi",
       "position": 1
     },
     {
       "@type": "ListItem",
       "item": "http://localhost:1313/writing/",
       "name": "Writings",
       "position": 2
     },
     {
       "@type": "ListItem",
       "name": "Build Git Hub Like Notifications With Django Messages and Angular Js",
       "position": 3
     }
   ]
 }
  </script>

  
  
    <meta name="author" content="Massimiliano Pippi" />
  
  
    
      <link href="https://github.com/masci" rel="me" />
    
  
  
  







  
  

  
  
</head>
<body
    class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden">
  <nav class="flex items-start justify-between sm:items-center">
    
    <div class="flex flex-row items-center">
      
  <a
    class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
    rel="me"
    href="/"
    >/dev/ by Massimiliano Pippi</a
  >

    </div>
    
    
      <ul class="flex list-none flex-col text-end sm:flex-row">
        
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/now/"
                  title="What I&#39;m doing Now"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Now</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/writing/"
                  title="Writings"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Stuff I write</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/book/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Stuff I read</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/talk/"
                  title="Talks"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Stuff I say</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="https://github.com/masci/dev"
                  title=""
                  target="_blank"
                  >
                    <span
                      class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                    ><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a
                >
              
            </li>
          
          
        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex grow flex-col">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
      <h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Build GitHub like notifications with Django messages and AngularJS
      </h1>
      
        <div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
          





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2013-10-22 00:00:00 &#43;0000 UTC">22 October 2013</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">8 mins</span>
    

    
    
  </div>

  
  


        </div>
      
      
    </header>
    <section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row">
      
      <div class="min-h-0 min-w-0 max-w-prose grow">
        <h2 id="foreword" class="relative group">Foreword <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#foreword" aria-label="Anchor">#</a></span></h2><p>GitHub has a very nice notification system, very similar to a plain old email inbox. You receive a notification which
remains <em>unread</em> until you actually read it; then it&rsquo;s archived and removed from your <em>inbox</em>, which it happens could remain empty:</p>
<p>





<figure>
    
    








  
    <picture
      class="mx-auto my-0 rounded-md"
      
    >
      
      
      
      
        <source
          
            srcset="http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/github_notifications_hu_41c587e860b771e0.webp 330w,http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/github_notifications_hu_8ee305e177ee3ccc.webp 660w
            
              
                ,http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/github_notifications_hu_8019ab29f3cae25b.webp 1023w
              
            
            
              
                ,http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/github_notifications_hu_8019ab29f3cae25b.webp 1023w
              
            "
          
          sizes="100vw"
          type="image/webp"
        />
      
      <img
        width="1023"
        height="546"
        class="mx-auto my-0 rounded-md"
        alt="github inbox"
        loading="lazy" decoding="async"
        
          src="http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/github_notifications_hu_7b191d354fa85b37.png" srcset="http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/github_notifications_hu_2230e08972812bc0.png 330w,http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/github_notifications_hu_7b191d354fa85b37.png 660w
          
            ,http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/github_notifications.png 1023w
          
          
            ,http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/github_notifications.png 1023w
          "
          sizes="100vw"
        
      />
    </picture>
  


</figure>
</p>
<p>For those who don&rsquo;t know, Django ships a library for displaying &ldquo;one-time&rdquo; messages to the users, it&rsquo;s called <em>Message
Framework</em> and you can find it in the <code>contrib</code> package. Messages are <em>produced</em> during users&rsquo; activity and delivered
subsequently; in the meantime, they are stored in cookies or sessions.</p>
<p>The ephemeral nature of Django&rsquo;s <code>contrib.messages</code> makes them not suitable for storing notifications in GitHub
style: notifications have to be persisted until user actually reads it, messages instead are marked as read the moment
they are, let&rsquo;s say, <em>observed</em>. Nevertheless Django message framework is flexible enough to let you provide your own
storage policy, and third-party applications like <a href="https://github.com/evonove/django-stored-messages" target="_blank" rel="noreferrer">Django Stored Messages</a>
use this feature to store messages in a persistent way (specifically, an sql database).</p>
<blockquote>
<p>Disclaimer: The frontend code will make use of AngularJs even if I am a total newbie and I don&rsquo;t really know how to
angular. If you are a newbie too, please go read <a href="http://toddmotto.com/ultimate-guide-to-learning-angular-js-in-one-day/" target="_blank" rel="noreferrer">this effective blog post</a>
by Todd Motto and then come back here. If you&rsquo;re not an Angular newbie, please take into account my code could offend
you.</p>
</blockquote>
<h2 id="the-application" class="relative group">The application <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#the-application" aria-label="Anchor">#</a></span></h2><p>Fire up a virtualenv and install Django:</p>
<pre><code>mkvirtualenv notification_example
pip install django
</code></pre>
<p>Start an empty project:</p>
<pre><code>django-admin.py startproject notification_example
</code></pre>
<p>&hellip;and an app:</p>
<pre><code>cd notification_example
python manage.py startapp notification
</code></pre>
<p>Now for some dependencies - install Django Stored Messages and <a href="http://http://django-rest-framework.org/" target="_blank" rel="noreferrer">Django Rest Framework</a>:</p>
<pre><code>pip install django-stored-messages djangorestframework
</code></pre>
<p>Configure all the things! In <code>notification_example/settings.py</code> be sure to have these:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>    PROJECT_ROOT <span style="color:#91d7e3;font-weight:bold">=</span> os<span style="color:#91d7e3;font-weight:bold">.</span>path<span style="color:#91d7e3;font-weight:bold">.</span>join(os<span style="color:#91d7e3;font-weight:bold">.</span>path<span style="color:#91d7e3;font-weight:bold">.</span>abspath(os<span style="color:#91d7e3;font-weight:bold">.</span>path<span style="color:#91d7e3;font-weight:bold">.</span>dirname(<span style="color:#f4dbd6">__file__</span>)), <span style="color:#a6da95">&#39;..&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    DATABASES <span style="color:#91d7e3;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6da95">&#39;default&#39;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#a6da95">&#39;ENGINE&#39;</span>: <span style="color:#a6da95">&#39;django.db.backends.sqlite3&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6da95">&#39;NAME&#39;</span>: os<span style="color:#91d7e3;font-weight:bold">.</span>path<span style="color:#91d7e3;font-weight:bold">.</span>join(PROJECT_ROOT, <span style="color:#a6da95">&#39;db.sqlite&#39;</span>),
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    INSTALLED_APPS <span style="color:#91d7e3;font-weight:bold">=</span> (
</span></span><span style="display:flex;"><span>        <span style="color:#a6da95">&#39;django.contrib.auth&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6da95">&#39;django.contrib.contenttypes&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6da95">&#39;django.contrib.sessions&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6da95">&#39;django.contrib.sites&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6da95">&#39;django.contrib.messages&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6da95">&#39;django.contrib.staticfiles&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6da95">&#39;notification&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6da95">&#39;stored_messages&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6da95">&#39;rest_framework&#39;</span>,
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    MESSAGE_STORAGE <span style="color:#91d7e3;font-weight:bold">=</span> <span style="color:#a6da95">&#39;stored_messages.storage.PersistentStorage&#39;</span>
</span></span></code></pre></div><p>Now let&rsquo;s go for some views. We will provide a view to serve the homepage, plus a view to show messages for the current
logged in user.</p>
<h2 id="the-homepage-view" class="relative group">The homepage view <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#the-homepage-view" aria-label="Anchor">#</a></span></h2><p>Django Stored Messages can persist messages only when they are sent to a valid user, and such user has to login for
viewing the messages, so we provide a login form directly inside the homepage. To produce some notifications, visiting the index will trigger a message as well. The code:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>    <span style="color:#8bd5ca">from</span> <span style="color:#f5a97f">django.views.generic</span> <span style="color:#8bd5ca">import</span> FormView
</span></span><span style="display:flex;"><span>    <span style="color:#8bd5ca">from</span> <span style="color:#f5a97f">django.contrib.auth.forms</span> <span style="color:#8bd5ca">import</span> AuthenticationForm
</span></span><span style="display:flex;"><span>    <span style="color:#8bd5ca">from</span> <span style="color:#f5a97f">django.contrib.messages</span> <span style="color:#8bd5ca">import</span> add_message
</span></span><span style="display:flex;"><span>    <span style="color:#8bd5ca">from</span> <span style="color:#f5a97f">django.contrib.auth</span> <span style="color:#8bd5ca">import</span> login
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8bd5ca">import</span> <span style="color:#f5a97f">stored_messages</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c6a0f6">class</span> <span style="color:#eed49f">IndexView</span>(FormView):
</span></span><span style="display:flex;"><span>        template_name <span style="color:#91d7e3;font-weight:bold">=</span> <span style="color:#a6da95">&#39;notification/homepage.html&#39;</span>
</span></span><span style="display:flex;"><span>        form_class <span style="color:#91d7e3;font-weight:bold">=</span> AuthenticationForm
</span></span><span style="display:flex;"><span>        success_url <span style="color:#91d7e3;font-weight:bold">=</span> <span style="color:#a6da95">&#39;/&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#c6a0f6">def</span> <span style="color:#8aadf4">get_context_data</span>(<span style="color:#91d7e3">self</span>, <span style="color:#91d7e3;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>            add_message(<span style="color:#91d7e3">self</span><span style="color:#91d7e3;font-weight:bold">.</span>request, stored_messages<span style="color:#91d7e3;font-weight:bold">.</span>STORED_INFO, <span style="color:#a6da95">&#39;You visited the homepage&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#c6a0f6">return</span> <span style="color:#91d7e3">super</span>(IndexView, <span style="color:#91d7e3">self</span>)<span style="color:#91d7e3;font-weight:bold">.</span>get_context_data(<span style="color:#91d7e3;font-weight:bold">**</span>kwargs)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#c6a0f6">def</span> <span style="color:#8aadf4">form_valid</span>(<span style="color:#91d7e3">self</span>, form):
</span></span><span style="display:flex;"><span>            login(<span style="color:#91d7e3">self</span><span style="color:#91d7e3;font-weight:bold">.</span>request, form<span style="color:#91d7e3;font-weight:bold">.</span>get_user())
</span></span><span style="display:flex;"><span>            <span style="color:#c6a0f6">return</span> <span style="color:#91d7e3">super</span>(IndexView, <span style="color:#91d7e3">self</span>)<span style="color:#91d7e3;font-weight:bold">.</span>form_valid(form)
</span></span></code></pre></div><p>We&rsquo;re going to use <em>class based views</em>, of course. Notice Django Stored Messages let us make use of the builtin
messages api, thus passing in a message of type <code>stored_messages.STORED_INFO</code> will cause that message to be stored on
the database.
The <a href="https://github.com/masci/notification_example/blob/master/templates/notification/homepage.html" target="_blank" rel="noreferrer">homepage template</a>
will be extended from a <a href="https://github.com/masci/notification_example/blob/master/templates/base.html" target="_blank" rel="noreferrer">basic Boostrap3 template</a>, we&rsquo;re going onto details later.</p>
<h2 id="the-message-view" class="relative group">The message view <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#the-message-view" aria-label="Anchor">#</a></span></h2><p>This is a simple <code>TemplateView</code>, the only trick here is getting from the urlstring whether user wants to see all the
notifications or only the <em>unread</em> ones:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>    <span style="color:#8bd5ca">from</span> <span style="color:#f5a97f">django.views.generic</span> <span style="color:#8bd5ca">import</span> TemplateView
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c6a0f6">class</span> <span style="color:#eed49f">MessagesView</span>(TemplateView):
</span></span><span style="display:flex;"><span>        template_name <span style="color:#91d7e3;font-weight:bold">=</span> <span style="color:#a6da95">&#39;notification/messages.html&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#c6a0f6">def</span> <span style="color:#8aadf4">get</span>(<span style="color:#91d7e3">self</span>, request, <span style="color:#91d7e3;font-weight:bold">*</span>args, <span style="color:#91d7e3;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>            <span style="color:#c6a0f6">if</span> <span style="color:#a6da95">&#39;unread&#39;</span> <span style="color:#91d7e3;font-weight:bold">in</span> request<span style="color:#91d7e3;font-weight:bold">.</span>GET:  <span style="color:#6e738d;font-style:italic"># quick and dirty</span>
</span></span><span style="display:flex;"><span>                kwargs[<span style="color:#a6da95">&#39;unread&#39;</span>] <span style="color:#91d7e3;font-weight:bold">=</span> <span style="color:#f5a97f">True</span>
</span></span><span style="display:flex;"><span>            <span style="color:#c6a0f6">return</span> <span style="color:#91d7e3">super</span>(MessagesView, <span style="color:#91d7e3">self</span>)<span style="color:#91d7e3;font-weight:bold">.</span>get(request, <span style="color:#91d7e3;font-weight:bold">*</span>args, <span style="color:#91d7e3;font-weight:bold">**</span>kwargs)
</span></span></code></pre></div><p>The view code is rather simple because all the magic is left to Django Stored Messages template tags and its REST api.
The Html template for the message view will try to mimic GitHub&rsquo;s notification page,
<a href="https://github.com/masci/notification_example/blob/master/templates/notification/messages.html" target="_blank" rel="noreferrer">here is the code</a> and
this is the result:</p>
<p>





<figure>
    
    








  
    <picture
      class="mx-auto my-0 rounded-md"
      
    >
      
      
      
      
        <source
          
            srcset="http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/messages_hu_367a3fbd82aa2263.webp 330w,http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/messages_hu_1d0725e3a612d2c.webp 660w
            
              ,http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/messages_hu_517c5d2885db0321.webp 1024w
            
            
              
                ,http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/messages_hu_2a4e02626ee567fd.webp 1217w
              
            "
          
          sizes="100vw"
          type="image/webp"
        />
      
      <img
        width="1217"
        height="648"
        class="mx-auto my-0 rounded-md"
        alt="messages screenshot"
        loading="lazy" decoding="async"
        
          src="http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/messages_hu_d071108838effb52.png" srcset="http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/messages_hu_6ab9529523e8a0bd.png 330w,http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/messages_hu_d071108838effb52.png 660w
          
            ,http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/messages_hu_d4c40c9ce8b22a8e.png 1024w
          
          
            ,http://localhost:1313/writing/2013/build-github-like-notifications-with-django-messages-and-angular-js/messages.png 1217w
          "
          sizes="100vw"
        
      />
    </picture>
  


</figure>
</p>
<p>As you can see from this chunk:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    &lt;<span style="color:#c6a0f6">div</span> <span style="color:#8aadf4">class</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;col-md-9&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    {% if not unread %}
</span></span><span style="display:flex;"><span>        {% stored_messages_archive 100 %}
</span></span><span style="display:flex;"><span>    {% else %}
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>    {% endif %}
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#c6a0f6">div</span>&gt;
</span></span></code></pre></div><p>If user requested the archive (i.e. to show messages that were already read), the template tag
<code>stored_messages_archive</code> provided by Django Stored Messages will show a list of <code>100</code> messages rendering
the template at <code>stored_messages/stored_messages_list.html</code>. Here is the template ovverrided to add Bootstrap3 classes:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    {% if messages %}
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#c6a0f6">ul</span> <span style="color:#8aadf4">class</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;list-group&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            {% for message in messages %}
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#c6a0f6">li</span> <span style="color:#8aadf4">class</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;list-group-item&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                    {{ message.message }}
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#c6a0f6">li</span>&gt;
</span></span><span style="display:flex;"><span>            {% empty %}
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#c6a0f6">li</span> <span style="color:#8aadf4">class</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;list-group-item&#34;</span>&gt;No messages here!&lt;/<span style="color:#c6a0f6">li</span>&gt;
</span></span><span style="display:flex;"><span>            {% endfor %}
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#c6a0f6">ul</span>&gt;
</span></span><span style="display:flex;"><span>    {% endif %}
</span></span></code></pre></div><p>We will get into the details for the <code>else</code> branch in the messages template later.</p>
<h2 id="plug-the-urls" class="relative group">Plug the urls <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#plug-the-urls" aria-label="Anchor">#</a></span></h2><p>Nothing special here but notice the inclusion of the REST api urls coming from <code>stored_messages</code> package:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>    urlpatterns <span style="color:#91d7e3;font-weight:bold">=</span> patterns(<span style="color:#a6da95">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>        url(<span style="color:#ed8796">r</span><span style="color:#a6da95">&#39;^logout/$&#39;</span>, <span style="color:#a6da95">&#39;django.contrib.auth.views.logout&#39;</span>,  {<span style="color:#a6da95">&#39;next_page&#39;</span>: <span style="color:#a6da95">&#39;/&#39;</span>}, name<span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#39;logout&#39;</span>),
</span></span><span style="display:flex;"><span>        url(<span style="color:#ed8796">r</span><span style="color:#a6da95">&#39;^$&#39;</span>, IndexView<span style="color:#91d7e3;font-weight:bold">.</span>as_view(), name<span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#39;home&#39;</span>),
</span></span><span style="display:flex;"><span>        url(<span style="color:#ed8796">r</span><span style="color:#a6da95">&#39;^messages/$&#39;</span>, MessagesView<span style="color:#91d7e3;font-weight:bold">.</span>as_view(), name<span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#39;messages&#39;</span>),
</span></span><span style="display:flex;"><span>        url(<span style="color:#ed8796">r</span><span style="color:#a6da95">&#39;^api/&#39;</span>, include(<span style="color:#a6da95">&#39;stored_messages.urls&#39;</span>)),
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div><h2 id="final-touches" class="relative group">Final touches <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#final-touches" aria-label="Anchor">#</a></span></h2><p>To add some noise to the notification stream, we will add messages for the user when she logs in and out:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>    <span style="color:#c6a0f6">def</span> <span style="color:#8aadf4">_user_logged_in</span>(<span style="color:#91d7e3;font-weight:bold">*</span>args, <span style="color:#91d7e3;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>        add_message(kwargs[<span style="color:#a6da95">&#39;request&#39;</span>], stored_messages<span style="color:#91d7e3;font-weight:bold">.</span>STORED_INFO, <span style="color:#a6da95">&#39;You were logged in!&#39;</span>)
</span></span><span style="display:flex;"><span>    user_logged_in<span style="color:#91d7e3;font-weight:bold">.</span>connect(_user_logged_in)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c6a0f6">def</span> <span style="color:#8aadf4">_user_logged_out</span>(<span style="color:#91d7e3;font-weight:bold">*</span>args, <span style="color:#91d7e3;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>        add_message(kwargs[<span style="color:#a6da95">&#39;request&#39;</span>], stored_messages<span style="color:#91d7e3;font-weight:bold">.</span>STORED_INFO, <span style="color:#a6da95">&#39;You were logged out!&#39;</span>)
</span></span><span style="display:flex;"><span>    user_logged_out<span style="color:#91d7e3;font-weight:bold">.</span>connect(_user_logged_out)
</span></span></code></pre></div><p>The Django app is complete now, time for some Javascript code!</p>
<h2 id="the-rest" class="relative group">The REST <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#the-rest" aria-label="Anchor">#</a></span></h2><p>Even if Django Stored Messages has a template tag to show unread messages, for this demo we will use the REST api,
which let us retrieve unread messages and mark them as read. To interact with the api we use
<a href="http://angularjs.org/" target="_blank" rel="noreferrer">Angular</a>, for the sake of simplicity we use a single controller:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>    <span style="color:#ed8796">var</span> messageApp <span style="color:#91d7e3;font-weight:bold">=</span> angular.module(<span style="color:#a6da95">&#39;messageApp&#39;</span>, []);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    messageApp.controller(<span style="color:#a6da95">&#39;MainCtrl&#39;</span>, [<span style="color:#a6da95">&#39;$scope&#39;</span>, <span style="color:#a6da95">&#39;$http&#39;</span>, <span style="color:#ed8796">function</span> ($scope, $http) {
</span></span><span style="display:flex;"><span>        <span style="color:#6e738d;font-style:italic">// Messages array
</span></span></span><span style="display:flex;"><span><span style="color:#6e738d;font-style:italic"></span>        $scope.messages <span style="color:#91d7e3;font-weight:bold">=</span> {};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6e738d;font-style:italic">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#6e738d;font-style:italic"></span>    }]);
</span></span></code></pre></div><p>Notice the injection of the <code>$http</code> object we will use to make http requests. The messages array will be filled with
data coming from the api, then it will be available through the <code>$scope</code> object. For the angular application to work
properly, the html code in our templates needs to be aware of the angular stuff - we do this in the <code>base.html</code> so that
every page could use angular facilities:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    <span style="color:#6e738d;font-style:italic">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#c6a0f6">html</span> <span style="color:#8aadf4">ng-app</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;messageApp&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#c6a0f6">head</span>&gt;
</span></span><span style="display:flex;"><span>        ...
</span></span></code></pre></div><p>and:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#c6a0f6">head</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#c6a0f6">body</span> <span style="color:#8aadf4">ng-controller</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;MainCtrl&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        <span style="color:#6e738d;font-style:italic">&lt;!-- navbar --&gt;</span>
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#c6a0f6">div</span> <span style="color:#8aadf4">class</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;navbar navbar-inverse navbar-fixed-top&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        ...
</span></span></code></pre></div><p>Inside the controller, this code will be added to retrieve all the unread messages for the logged-in user:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>    <span style="color:#6e738d;font-style:italic">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#6e738d;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#6e738d;font-style:italic">// retrieve Messages from the restAPI
</span></span></span><span style="display:flex;"><span><span style="color:#6e738d;font-style:italic"></span>    $http({
</span></span><span style="display:flex;"><span>        method<span style="color:#91d7e3;font-weight:bold">:</span> <span style="color:#a6da95">&#39;GET&#39;</span>,
</span></span><span style="display:flex;"><span>        url<span style="color:#91d7e3;font-weight:bold">:</span> <span style="color:#a6da95">&#39;//127.0.0.1:8000/api/inbox/&#39;</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .success(<span style="color:#ed8796">function</span> (data, status, headers, config) {
</span></span><span style="display:flex;"><span>        $scope.messages <span style="color:#91d7e3;font-weight:bold">=</span> data;
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .error(<span style="color:#ed8796">function</span> (data, status, headers, config) {
</span></span><span style="display:flex;"><span>        <span style="color:#6e738d;font-style:italic">// something went wrong :(
</span></span></span><span style="display:flex;"><span><span style="color:#6e738d;font-style:italic"></span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6e738d;font-style:italic">// ...
</span></span></span></code></pre></div><p>If everything goes fine, <code>$scope.messages</code> will contain our messages and we can use them inside the DOM. To do this, we
need some angularities inside the html, for example in the <code>message.html</code> template:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    {% verbatim %}
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#c6a0f6">ul</span> <span style="color:#8aadf4">class</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;list-group&#34;</span> <span style="color:#8aadf4">ng-if</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;messages.length&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#c6a0f6">li</span> <span style="color:#8aadf4">class</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;list-group-item&#34;</span> <span style="color:#8aadf4">ng-repeat</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;message in messages&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        {{ message.message.date | date:&#39;MMM d, y h:mm:ss a&#39; }} - {{ message.message.message }}
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#c6a0f6">a</span> <span style="color:#8aadf4">ng-click</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;markRead($index)&#34;</span> <span style="color:#8aadf4">style</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;cursor:pointer&#34;</span>&gt;Mark as read&lt;/<span style="color:#c6a0f6">a</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#c6a0f6">li</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#c6a0f6">ul</span>&gt;
</span></span><span style="display:flex;"><span>    {% endverbatim %}
</span></span></code></pre></div><p>The <code>ng-if</code> attribute determines if we have some messages to show. If we do have, the <code>ng-repeat</code> attribute will take
care of iterating the messages and show them in the DOM through angular&rsquo;s template tags.</p>
<blockquote>
<p>Warning: we&rsquo;re mixing Django and Angular templates there and since they share the same template syntax (this could
be changed in angular but it&rsquo;s not generally advisable) we need to wrap angular code inside Django&rsquo;s <code>verbatim</code> tags.</p>
</blockquote>
<p>In the html code above notice this:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    &lt;<span style="color:#c6a0f6">a</span> <span style="color:#8aadf4">ng-click</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;markRead($index)&#34;</span> <span style="color:#8aadf4">style</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;cursor:pointer&#34;</span>&gt;Mark as read&lt;/<span style="color:#c6a0f6">a</span>&gt;
</span></span></code></pre></div><p>For every unread message, we provide a link and we tell angular that when user clicks it (<code>ng-click</code> attribute) the
function <code>markRead()</code> has to be called with the parameter <code>$index</code>. We define that function inside the angular
controller and attach it to the <code>$scope</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>    <span style="color:#6e738d;font-style:italic">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#6e738d;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#6e738d;font-style:italic">// mark messages read
</span></span></span><span style="display:flex;"><span><span style="color:#6e738d;font-style:italic"></span>    $scope.markRead <span style="color:#91d7e3;font-weight:bold">=</span> <span style="color:#ed8796">function</span> (index) {
</span></span><span style="display:flex;"><span>        <span style="color:#ed8796">var</span> id <span style="color:#91d7e3;font-weight:bold">=</span> $scope.messages[index].id;
</span></span><span style="display:flex;"><span>        $http({
</span></span><span style="display:flex;"><span>            method<span style="color:#91d7e3;font-weight:bold">:</span> <span style="color:#a6da95">&#39;POST&#39;</span>,
</span></span><span style="display:flex;"><span>            url<span style="color:#91d7e3;font-weight:bold">:</span> <span style="color:#a6da95">&#39;//127.0.0.1:8000/api/inbox/&#39;</span><span style="color:#91d7e3;font-weight:bold">+</span>id<span style="color:#91d7e3;font-weight:bold">+</span><span style="color:#a6da95">&#39;/read/&#39;</span>,
</span></span><span style="display:flex;"><span>            xsrfHeaderName<span style="color:#91d7e3;font-weight:bold">:</span> <span style="color:#a6da95">&#39;X-CSRFToken&#39;</span>,
</span></span><span style="display:flex;"><span>            xsrfCookieName<span style="color:#91d7e3;font-weight:bold">:</span> <span style="color:#a6da95">&#39;csrftoken&#39;</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        .success(<span style="color:#ed8796">function</span> (data, status, headers, config) {
</span></span><span style="display:flex;"><span>            $scope.messages.splice(index, <span style="color:#f5a97f">1</span>);
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        .error(<span style="color:#ed8796">function</span> (data, status, headers, config) {
</span></span><span style="display:flex;"><span>            <span style="color:#6e738d;font-style:italic">// something went wrong :(
</span></span></span><span style="display:flex;"><span><span style="color:#6e738d;font-style:italic"></span>        })
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#6e738d;font-style:italic">// ...
</span></span></span></code></pre></div><p>The parameter passed to <code>$http</code> contains all the logic needed to retrieve the csrf token from user&rsquo;s cookie and pass it
to Django inside the <code>X-CSRFToken</code> header. For my experience, I&rsquo;ve never seen an easier way to do this (thank you so
much, Angular!). After retrieving the database id for the <em>index-th</em> message, we call the <code>/api/inbox/{lookup}/read/</code>
endpoint which marks that message as read. In case the request goes well (and this is where magics happen), we remove
the element from the <code>$scope.messages</code> - angular will remove that element from the DOM afterwards. No code. No explicit
DOM manipulation. Just fun.</p>
<p>Since Django Stored Messages api exposes an endpoint to mark all messages read, we provide a button to do exactly this.
The code for the button is very similar to the one to mark messages read:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>    &lt;<span style="color:#c6a0f6">button</span> <span style="color:#8aadf4">type</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;button&#34;</span> <span style="color:#8aadf4">class</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;btn btn-success&#34;</span> <span style="color:#8aadf4">ng-click</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#a6da95">&#34;markAllRead()&#34;</span>&gt;Mark all read&lt;/<span style="color:#c6a0f6">button</span>&gt;
</span></span></code></pre></div><p>This time the function name is <code>markAllRead</code> and we call it without parameters; the function is defined inside the
controller:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>    <span style="color:#6e738d;font-style:italic">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#6e738d;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#6e738d;font-style:italic">// mark all read
</span></span></span><span style="display:flex;"><span><span style="color:#6e738d;font-style:italic"></span>    $scope.markAllRead <span style="color:#91d7e3;font-weight:bold">=</span> <span style="color:#ed8796">function</span> () {
</span></span><span style="display:flex;"><span>        $http({
</span></span><span style="display:flex;"><span>            method<span style="color:#91d7e3;font-weight:bold">:</span> <span style="color:#a6da95">&#39;POST&#39;</span>,
</span></span><span style="display:flex;"><span>            url<span style="color:#91d7e3;font-weight:bold">:</span> <span style="color:#a6da95">&#39;//127.0.0.1:8000/api/mark_all_read/&#39;</span>,
</span></span><span style="display:flex;"><span>            xsrfHeaderName<span style="color:#91d7e3;font-weight:bold">:</span> <span style="color:#a6da95">&#39;X-CSRFToken&#39;</span>,
</span></span><span style="display:flex;"><span>            xsrfCookieName<span style="color:#91d7e3;font-weight:bold">:</span> <span style="color:#a6da95">&#39;csrftoken&#39;</span>
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        .success(<span style="color:#ed8796">function</span>(data, status, headers, config) {
</span></span><span style="display:flex;"><span>            $scope.messages.splice(<span style="color:#f5a97f">0</span>, $scope.messages.length);
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        .error(<span style="color:#ed8796">function</span>(data, status, headers, config){
</span></span><span style="display:flex;"><span>            <span style="color:#6e738d;font-style:italic">// something went wrong :(
</span></span></span><span style="display:flex;"><span><span style="color:#6e738d;font-style:italic"></span>        })
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#6e738d;font-style:italic">// ...
</span></span></span></code></pre></div><p>The csrf boilerplate is the same (for the record, this could be easily avoided using some advanced angular features)
and the logic is very similar: in case the request succeeded, the array of messages is cleared and the DOM reflects the
changes automagically.</p>
<h2 id="references" class="relative group">References <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#references" aria-label="Anchor">#</a></span></h2><ul>
<li><a href="https://github.com/masci/notification_example" target="_blank" rel="noreferrer">A working example is on GitHub</a></li>
<li><a href="http://django-stored-messages.rtfd.org/" target="_blank" rel="noreferrer">Django Stored Messages documentation</a></li>
</ul>

      </div>
    </section>
    <footer class="max-w-prose pt-8 print:hidden">
      

      

      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="group flex" href="http://localhost:1313/moving-to-jekyll/">
              <span
                class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&larr;</span
                ><span class="ltr:hidden rtl:inline">&rarr;</span></span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Moving to Jekyll</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2013-08-10 00:00:00 &#43;0000 UTC">10 August 2013</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="group flex text-right" href="http://localhost:1313/stop-asking-users-for-passwords-and-let-oauth2-do/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Stop asking users for passwords and let OAuth2 do the job instead</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2013-11-10 00:00:00 &#43;0000 UTC">10 November 2013</time>
                  
                </span>
              </span>
              <span
                class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[-2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&rarr;</span
                ><span class="ltr:hidden rtl:inline">&larr;</span></span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

      </main>
      
        <div
          class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"
          id="to-top"
          hidden="true"
        >
          <a
            href="#the-top"
            class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
            aria-label="Scroll to top"
            title="Scroll to top"
          >
            &uarr;
          </a>
        </div>
      <footer class="py-10 print:hidden">
  
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            &copy;
            2025
            Massimiliano Pippi
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://github.com/jpanther/congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    <div class="flex flex-row items-center">
      
      
      
      
        <div
          class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        >
          <button id="appearance-switcher-0" type="button" aria-label="appearance switcher">
            <div
              class="flex h-12 w-12 items-center justify-center dark:hidden"
              title="Switch to dark appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
            </div>
            <div
              class="hidden h-12 w-12 items-center justify-center dark:flex"
              title="Switch to light appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
            </div>
          </button>
        </div>
      
    </div>
  </div>
  
  
</footer>

    </div>
  </body>
</html>
